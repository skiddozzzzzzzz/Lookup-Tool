<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IP Lookup Pro – Full Address & Nearest Airport</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:system-ui;background:#f4f6f9;color:#1f2937;margin:0;padding:2rem;display:flex;justify-content:center;min-height:100vh;}
.container{max-width:700px;width:100%;background:#fff;border-radius:1rem;box-shadow:0 10px 30px rgba(0,0,0,.1);padding:2rem;}
h1{text-align:center;color:#2563eb;margin-bottom:1.5rem;font-size:1.9rem;}
input,button{width:100%;padding:.9rem;margin:.6rem 0;border-radius:.6rem;font-size:1rem;transition:.2s;}
input{border:2px solid #e2e8f0;}
input:focus{outline:none;border-color:#2563eb;}
button{background:#2563eb;color:white;border:none;font-weight:600;cursor:pointer;}
button:hover{background:#1d4ed8;}
.result{display:none;margin-top:1.5rem;padding:1.2rem;background:#f8fafc;border:1px solid #e2e8f0;border-radius:.8rem;}
.result.show{display:block;}
.address-box,.airport-box{padding:1rem;border-radius:.5rem;margin:.5rem 0;font-family:'Courier New',monospace;font-size:.95rem;line-height:1.5;}
.address-box{background:#ecfdf5;border-left:4px solid #10b981;}
.airport-box{background:#fef9c7;border-left:4px solid #f59e0b;}
.airport-list{max-height:300px;overflow-y:auto;border:1px solid #ddd;border-radius:.5rem;padding:.5rem;background:#fff;font-size:.9rem;}
.airport-item{padding:.6rem .8rem;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;}
.airport-item:last-child{border-bottom:none;}
.airport-name{font-weight:600;}
.airport-dist{color:#dc2626;font-weight:bold;}
.copy-notif{position:fixed;bottom:20px;right:20px;background:#10b981;color:white;padding:.8rem 1.2rem;border-radius:.5rem;font-weight:500;box-shadow:0 4px 12px rgba(0,0,0,.15);opacity:0;transition:opacity .3s;pointer-events:none;z-index:1000;}
.copy-notif.show{opacity:1;}
</style>
</head>
<body>
<div class="container">
<h1>IP Lookup Pro</h1>
<input id="ipInput" placeholder="Enter IP (leave blank for your IP)">
<button onclick="lookupIP()">Lookup IP</button>

<div class="result" id="result">
    <div>
        <p><strong>IP:</strong> <span id="ip"></span></p>
        <p><strong>Country:</strong> <span id="country"></span></p>
        <p><strong>ISP:</strong> <span id="isp"></span></p>
    </div>
    <div>
        <h3>Home Address</h3>
        <div class="address-box" id="address">—</div>
    </div>
    <div>
        <h3>Nearest Airport</h3>
        <div class="airport-box" id="nearestAirport">—</div>
    </div>
    <div>
        <h3>All Nearby Airports (50 km)</h3>
        <div class="airport-list" id="airportList"><em>No airports found.</em></div>
    </div>
    <button onclick="copyResults()">Copy Results</button>
</div>
<div class="copy-notif" id="copyNotif">Copied!</div>
</div>

<script>
async function reverseGeocode(lat, lon){
    try{
        const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1&accept-language=en`,{
            headers:{'User-Agent':'IPLookupTool/1.0'}
        });
        const data = await res.json();
        const a = data.address;
        const parts = [];
        if(a.road) parts.push(a.road);
        if(a.house_number) parts.push(a.house_number);
        if(a.suburb||a.neighbourhood) parts.push(a.suburb||a.neighbourhood);
        if(a.city||a.town||a.village) parts.push(a.city||a.town||a.village);
        if(a.postcode) parts.push(a.postcode);
        if(a.state) parts.push(a.state);
        if(a.country) parts.push(a.country);
        return parts.join(', ')||data.display_name||"Unknown";
    }catch(e){return "Address not available";}
}

// Haversine formula
function distance(lat1, lon1, lat2, lon2){
    const R=6371;
    const dLat=(lat2-lat1)*Math.PI/180;
    const dLon=(lon2-lon1)*Math.PI/180;
    const a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
    return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

async function getAirports(lat, lon){
    try{
        // Airportgap API (Free, no key)
        const resp = await fetch(`https://airportgap.dev-tester.com/api/airports?lat=${lat}&lng=${lon}&distance=50`);
        const data = await resp.json();
        // Sort by distance
        data.sort((a,b)=>a.distance-b.distance);
        for(const a of data){
            a.fullAddress = await reverseGeocode(a.lat,a.lng);
        }
        return data;
    }catch(e){ return []; }
}

async function lookupIP(){
    const ip = document.getElementById('ipInput').value.trim() || (await (await fetch('https://api.ipify.org?format=json')).json()).ip;
    document.getElementById('ip').textContent = ip;

    try{
        const geo = await (await fetch(`https://ipapi.co/${ip}/json/`)).json();
        document.getElementById('country').textContent = `${geo.country_name} (${geo.country})`;
        document.getElementById('isp').textContent = geo.org||geo.asn||"Unknown";

        const homeAddr = await reverseGeocode(geo.latitude, geo.longitude);
        document.getElementById('address').textContent = homeAddr;

        const airports = await getAirports(geo.latitude, geo.longitude);
        if(airports.length){
            const nearest = airports[0];
            document.getElementById('nearestAirport').innerHTML = `<strong>${nearest.name} (${nearest.iata||nearest.icao||''})</strong><br>${nearest.distance.toFixed(1)} km away<br>${nearest.fullAddress}`;
            document.getElementById('airportList').innerHTML = airports.map(a=>`<div class="airport-item"><div class="airport-name">${a.name}</div><div class="airport-dist">${a.distance.toFixed(1)} km</div></div>`).join('');
        }else{
            document.getElementById('nearestAirport').textContent="No airports found nearby";
            document.getElementById('airportList').innerHTML="<em>No airports found.</em>";
        }

        document.getElementById('result').classList.add('show');
    }catch(e){
        alert("Error fetching data: "+e.message);
    }
}

async function copyResults(){
    const text = `
IP: ${document.getElementById('ip').textContent}
Country: ${document.getElementById('country').textContent}
ISP: ${document.getElementById('isp').textContent}

Home Address:
${document.getElementById('address').textContent}

Nearest Airport:
${document.getElementById('nearestAirport').innerText}
`;
    await navigator.clipboard.writeText(text);
    const notif = document.getElementById('copyNotif');
    notif.classList.add('show');
    setTimeout(()=>notif.classList.remove('show'),2000);
}

document.getElementById('ipInput').addEventListener('keypress',e=>{if(e.key==='Enter')lookupIP();});
</script>
</body>
</html>
